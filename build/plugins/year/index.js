(()=>{"use strict";const e=window.wp.plugins,t=window.wp.editor,n=window.wp.components,i=window.wp.data,l=window.wp.coreData,a=window.wp.blockEditor,o=window.wp.richText,r=window.React,s=window.ReactJSXRuntime;let m,c,_,d,u,x=null;const v=e=>{const t={...x,mve_timeline_image:e?e.id:null,mve_timeline_image_src:e?JSON.stringify(e.sizes):null};e||(t.mve_timeline_image_source=null,t.mve_timeline_image_info=null,t.mve_timeline_image_src=null),u(t)},p=e=>{u({...x,mve_timeline_image_source:e})},g=e=>{u({...x,mve_timeline_image_info:e})},h=function(){return(0,s.jsxs)(a.MediaUploadCheck,{children:[(0,s.jsx)(n.__experimentalText,{upperCase:!0,children:"Image"}),(0,s.jsx)(a.MediaUpload,{onSelect:v,allowedTypes:["image"],value:m,render:({open:e})=>(0,s.jsxs)(s.Fragment,{children:[d&&(0,s.jsx)("div",{style:{display:"block"},children:(0,s.jsx)(n.ResponsiveWrapper,{naturalWidth:d.media_details.width,naturalHeight:d.media_details.height,children:(0,s.jsx)("img",{src:d.source_url})})}),(0,s.jsxs)("div",{style:{display:"block"},children:[!d&&(0,s.jsx)(n.Button,{variant:"secondary",onClick:e,children:"Open Media Library"}),d&&(0,s.jsx)(n.Button,{onClick:()=>v(null),isLink:!0,isDestructive:!0,children:"Remove image"})]})]})}),d&&(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,value:c,onChange:p,label:"Source"}),d&&(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,value:_,onChange:g,label:"Info"})]})};let j,y,C=null;const S=function(){const[e,t]=(0,r.useState)(""),[i,l]=(0,r.useState)("");return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("ul",{style:{overflowX:"auto",listStyleType:"none",padding:0,margin:0,marginBottom:"1rem"},children:C.map(e=>(0,s.jsxs)("li",{style:{whiteSpace:"nowrap"},children:[(0,s.jsx)(n.Button,{isDestructive:!0,size:"small",onClick:()=>(e=>{const t=[];for(const n of C)n.name===e.name&&n.url===e.url||t.push(n);y({...j,mve_timeline_links:JSON.stringify(t)})})(e),children:"X"})," ",e.name," - ",e.url]},e.url))}),(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,value:e,onChange:e=>t(e),label:"Title"}),(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,value:i,onChange:e=>l(e),label:"URL"}),(0,s.jsx)(n.Button,{size:"small",variant:"secondary",onClick:()=>{C.push({name:e,url:i}),y({...j,mve_timeline_links:JSON.stringify(C)}),t(""),l("")},disabled:!(e&&i),children:"Add link"})]})};let k,w,b=null;const f=e=>{w({...k,mve_timeline_intro:e})},T=function(){return(0,s.jsx)(a.RichText,{placeholder:"Intro...",allowedFormats:["core/bold","core/italic","core/link","mve-timeline/internal-link"],label:"MVE Timeline Intro",value:b,onChange:f,style:{backgroundColor:"white",padding:"1rem",border:"1px solid #C0C0C0"}})};let N,B,P,R,M,D,H,z,I,E,F=null;function A(e){e=parseInt(e,10),F("postType","mve_timeline_item",P,{mve_timeline:isNaN(e)?[0]:[parseInt(e,10)]})}const V=e=>{""===e?B({...N,mve_timeline_year:null}):(e=parseInt(e,10),B({...N,mve_timeline_year:isNaN(e)?null:e.toString()}))},L=e=>{B(""===e?{...N,mve_timeline_year_name:null}:{...N,mve_timeline_year_name:e})},O=e=>{""===e?B({...N,mve_timeline_year_end:null}):(e=parseInt(e,10),B({...N,mve_timeline_year_end:isNaN(e)?null:e.toString()}))},J=e=>{B(""===e?{...N,mve_timeline_year_end_name:null}:{...N,mve_timeline_year_end_name:e})},Y={backgroundColor:"red",color:"white"},U=function(){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.__experimentalHStack,{children:[(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:H?null:Y,onChange:V,value:H,label:"Year start *"}),(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:O,value:z,label:"Year end"})]}),(0,s.jsxs)(n.__experimentalHStack,{children:[(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:L,value:I,label:"Year start name"}),(0,s.jsx)(n.TextControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,onChange:J,value:E,label:"Year end name"})]}),(0,s.jsx)(n.SelectControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:M&&0!==M.length&&0!==M[0]?null:Y,label:"Timeline *",options:D,onChange:A,value:M?M[0]:""})]})};wp.domReady(()=>{let e=!1;(0,i.subscribe)(()=>{const t=(0,i.select)("core/editor").getEditedPostAttribute("meta"),n=(0,i.select)("core/editor").getEditedPostAttribute("mve_timeline");t&&n&&(t.mve_timeline_year&&0!==n.length&&0!==n[0]?e&&(e=!1,(0,i.dispatch)("core/editor").unlockPostSaving("requiredValueLock")):e||(e=!0,(0,i.dispatch)("core/editor").lockPostSaving("requiredValueLock")))})}),(0,e.registerPlugin)("mve-timeline",{render:function(){var e;const a=(0,i.useSelect)(e=>e("core/editor").getCurrentPostType(),[]),o=(0,i.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),[r,v]=(0,l.useEntityProp)("postType",a,"meta");if(function(e,t){var n,l;x=e,u=t,m=e.mve_timeline_image,c=null!==(n=e.mve_timeline_image_source)&&void 0!==n?n:"",_=null!==(l=e.mve_timeline_image_info)&&void 0!==l?l:"",d=(0,i.useSelect)(e=>e("core").getEntityRecord("postType","attachment",m),[m])}(r,v),function(e,t){j=e,y=t,C=e.mve_timeline_links,C=C?JSON.parse(C):[]}(r,v),function(e,t){k=e,w=t,b=e.mve_timeline_intro}(r,v),function(e,t,n){var l,a,o,r;N=e,B=t,P=n;const s=(0,i.useDispatch)("core");F=s.editEntityRecord,R=(0,i.useSelect)(e=>e("core").getEntityRecords("taxonomy","mve_timeline",{orderBy:"name",order:"asc",per_page:-1})),M=(0,i.useSelect)(e=>e("core/editor").getEditedPostAttribute("mve_timeline"),[]),D=[{value:0,label:"Choose timeline..."}].concat(R?R.map(e=>({value:e.id,label:e.name})):[]),H=null!==(l=e.mve_timeline_year)&&void 0!==l?l:"",z=null!==(a=e.mve_timeline_year_end)&&void 0!==a?a:"",I=null!==(o=e.mve_timeline_year_name)&&void 0!==o?o:"",E=null!==(r=e.mve_timeline_year_end_name)&&void 0!==r?r:""}(r,v,o),"mve_timeline_item"!==a)return null;const p=null!==(e=r.mve_timeline_content)&&void 0!==e&&e,g={backgroundColor:"#F3F3F3",padding:".4rem",width:"100%"};return(0,s.jsxs)(t.PluginDocumentSettingPanel,{title:"MVE Timeline",initialOpen:!0,name:"mve_timeline_panel",children:[(0,s.jsx)(n.PanelRow,{children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(n.__experimentalVStack,{children:(0,s.jsx)(U,{})})})}),(0,s.jsx)(n.PanelRow,{children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(n.CheckboxControl,{__nextHasNoMarginBottom:!0,label:"Has content",checked:p,onChange:e=>{v({...r,mve_timeline_content:e})}})})}),(0,s.jsx)(n.PanelRow,{children:(0,s.jsx)("div",{style:g,children:(0,s.jsx)(n.__experimentalVStack,{children:(0,s.jsx)(h,{})})})}),(0,s.jsx)(n.PanelRow,{children:(0,s.jsx)("div",{style:g,children:(0,s.jsxs)(n.__experimentalVStack,{children:[(0,s.jsx)(n.__experimentalText,{upperCase:!0,children:"Intro"}),(0,s.jsx)(T,{})]})})}),(0,s.jsx)(n.PanelRow,{children:(0,s.jsx)("div",{style:g,children:(0,s.jsxs)(n.__experimentalVStack,{children:[(0,s.jsx)(n.__experimentalText,{upperCase:!0,children:"Links"}),(0,s.jsx)(S,{})]})})})]})}});const W=({pages:e,onChange:t,value:i})=>(0,s.jsx)(n.SelectControl,{__nextHasNoMarginBottom:!0,__next40pxDefaultSize:!0,style:{minWidth:"300px"},value:i,label:"Select page",onChange:t,options:e.map(function(e){return{value:e.id,label:`${e.meta.mve_timeline_year} - ${e.title.raw}`}})});(0,o.registerFormatType)("mve-timeline/internal-link",{title:"Internal link",tagName:"a",className:"mve-internal-link",attributes:{name:"data-internal-id"},edit:({isActive:e,onChange:t,value:l,activeAttributes:m,contentRef:c})=>{const[_,d]=(0,r.useState)(c.current),u=(0,i.useSelect)(e=>e("core/editor").getCurrentPostId(),[]),x=(0,i.useSelect)(e=>e("core/block-editor").getSelectedBlock(),[]);if(x&&!["core/paragraph","mve-timeline/intro"].includes(x.name))return null;const v=(0,i.useSelect)(e=>e("core/editor").getEditedPostAttribute("mve_timeline"),[]),p=(0,i.useSelect)(e=>e("core").getEntityRecords("postType","mve_timeline_item",v&&u?{mve_timeline:v,exclude:[u]}:{}),[v,u]);return(0,s.jsxs)(a.BlockControls,{children:[(0,s.jsx)(n.ToolbarButton,{icon:"admin-links",title:"Internal link",onClick:()=>{t((0,o.toggleFormat)(l,{type:"mve-timeline/internal-link"}))},isActive:e}),e&&p&&(0,s.jsx)(n.Popover,{anchor:_,variant:"toolbar",children:(0,s.jsx)(n.Card,{children:(0,s.jsx)(n.CardBody,{children:(0,s.jsx)(W,{pages:p,value:m?.name,onChange:e=>{const n=(0,o.applyFormat)(l,{type:"mve-timeline/internal-link",attributes:{name:e}});t(n)}})})})})]})}})})();