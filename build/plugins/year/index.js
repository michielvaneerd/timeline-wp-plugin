(()=>{"use strict";const e=window.React,t=window.wp.plugins,n=window.wp.editPost,l=window.wp.components,i=window.wp.data,a=window.wp.coreData,r=window.wp.blockEditor,o=window.wp.richText;(0,t.registerPlugin)("mve-timeline",{render:function(){const t=(0,i.useSelect)((e=>e("core/editor").getCurrentPostType()),[]),o=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),{editEntityRecord:c}=(0,i.useDispatch)("core"),[m,s]=(0,a.useEntityProp)("postType",t,"meta");console.log(m);const u=m.mve_timeline_year,d=m.mve_timeline_image,p=e=>{s({...m,mve_timeline_image:e?e.id:null})},g=(0,i.useSelect)((e=>e("core").getEntityRecords("taxonomy","mve_timeline",{orderBy:"name",order:"asc",per_page:-1}))),v=(0,i.useSelect)((e=>e("core/editor").getEditedPostAttribute("mve_timeline")),[]),E=(0,i.useSelect)((e=>e("core").getMedia(d)),[d]),w=[{value:0,label:"Choose timeline..."}].concat(g?g.map((e=>({value:e.id,label:e.name}))):[]);return(0,e.createElement)(n.PluginDocumentSettingPanel,{title:"MVE Timeline",initialOpen:!0},(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.TextControl,{label:"MVE Timeline Year",value:u,onChange:e=>{e=parseInt(e,10),s({...m,mve_timeline_year:isNaN(e)?0:e})}})),(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.SelectControl,{label:"Timeline",options:w,onChange:function(e){e=parseInt(e,10),c("postType","mve_timeline_item",o,{mve_timeline:isNaN(e)?[0]:[parseInt(e,10)]})},value:v?v[0]:""})),(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.__experimentalVStack,null,(0,e.createElement)(r.MediaUploadCheck,null,(0,e.createElement)("div",{style:{display:"block"}},(0,e.createElement)(l.__experimentalText,{upperCase:!0},"Image")),(0,e.createElement)(r.MediaUpload,{onSelect:p,allowedTypes:["image"],value:d,render:({open:t})=>(0,e.createElement)(e.Fragment,null,E&&(0,e.createElement)("div",{style:{display:"block"}},(0,e.createElement)(l.ResponsiveWrapper,{naturalWidth:E.media_details.width,naturalHeight:E.media_details.height},(0,e.createElement)("img",{src:E.source_url}))),(0,e.createElement)("div",{style:{display:"block"}},!E&&(0,e.createElement)(l.Button,{variant:"secondary",onClick:t},"Open Media Library"),E&&(0,e.createElement)(l.Button,{onClick:()=>p(null),isLink:!0,isDestructive:!0},"Remove image")))})))))}});const c=({pages:t,onChange:n,value:i})=>(0,e.createElement)(l.SelectControl,{style:{minWidth:"300px"},__nextHasNoMarginBottom:!0,value:i,label:"Select page",onChange:n,options:t.map((function(e){return{value:e.id,label:`${e.meta.mve_timeline_year} - ${e.title.raw}`}}))});(0,o.registerFormatType)("mve-timeline/internal-link",{title:"Internal link",tagName:"a",className:"mve-internal-link",attributes:{name:"data-internal-id"},edit:({isActive:t,onChange:n,value:a,activeAttributes:m,contentRef:s})=>{const[u,d]=(0,e.useState)(s.current),p=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),g=(0,i.useSelect)((e=>e("core/block-editor").getSelectedBlock()),[]);if(g&&!["core/paragraph","mve-timeline/intro"].includes(g.name))return null;const v=(0,i.useSelect)((e=>e("core/editor").getEditedPostAttribute("mve_timeline")),[]),E=(0,i.useSelect)((e=>e("core").getEntityRecords("postType","mve_timeline_item",v&&p?{mve_timeline:v,exclude:[p]}:{})),[v,p]);return(0,e.createElement)(r.BlockControls,null,(0,e.createElement)(l.ToolbarButton,{icon:"admin-links",title:"Internal link",onClick:()=>{n((0,o.toggleFormat)(a,{type:"mve-timeline/internal-link"}))},isActive:t}),t&&E&&(0,e.createElement)(l.Popover,{anchor:u,variant:"toolbar"},(0,e.createElement)(l.Card,null,(0,e.createElement)(l.CardBody,null,(0,e.createElement)(c,{pages:E,value:m?.name,onChange:e=>{const t=(0,o.applyFormat)(a,{type:"mve-timeline/internal-link",attributes:{name:e}});n(t)}})))))}})})();