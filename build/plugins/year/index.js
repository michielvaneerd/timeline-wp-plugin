(()=>{"use strict";const e=window.React,t=window.wp.plugins,n=window.wp.editPost,l=window.wp.components,i=window.wp.data,a=window.wp.coreData,r=window.wp.blockEditor,o=window.wp.richText;(0,t.registerPlugin)("mve-timeline",{render:function(){var t;const o=(0,i.useSelect)((e=>e("core/editor").getCurrentPostType()),[]),m=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),{editEntityRecord:c}=(0,i.useDispatch)("core"),[s,u]=(0,a.useEntityProp)("postType",o,"meta"),d=s.mve_timeline_year,p=s.mve_timeline_image,v=null!==(t=s.mve_timeline_image_source)&&void 0!==t?t:"",g=e=>{const t={...s,mve_timeline_image:e?e.id:null};e||(t.mve_timeline_image_source=null),u(t)},_=(0,i.useSelect)((e=>e("core").getEntityRecords("taxonomy","mve_timeline",{orderBy:"name",order:"asc",per_page:-1}))),E=(0,i.useSelect)((e=>e("core/editor").getEditedPostAttribute("mve_timeline")),[]),w=(0,i.useSelect)((e=>e("core").getMedia(p)),[p]),y=[{value:0,label:"Choose timeline..."}].concat(_?_.map((e=>({value:e.id,label:e.name}))):[]);return(0,e.createElement)(n.PluginDocumentSettingPanel,{title:"MVE Timeline",initialOpen:!0},(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.TextControl,{label:"MVE Timeline Year",value:d,onChange:e=>{e=parseInt(e,10),u({...s,mve_timeline_year:isNaN(e)?0:e})}})),(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.SelectControl,{label:"Timeline",options:y,onChange:function(e){e=parseInt(e,10),c("postType","mve_timeline_item",m,{mve_timeline:isNaN(e)?[0]:[parseInt(e,10)]})},value:E?E[0]:""})),(0,e.createElement)(l.PanelRow,null,(0,e.createElement)(l.__experimentalVStack,null,(0,e.createElement)(r.MediaUploadCheck,null,(0,e.createElement)("div",{style:{display:"block"}},(0,e.createElement)(l.__experimentalText,{upperCase:!0},"Image")),w&&(0,e.createElement)(l.TextControl,{value:v,onChange:e=>{u({...s,mve_timeline_image_source:e})},placeholder:"Image source"}),(0,e.createElement)(r.MediaUpload,{onSelect:g,allowedTypes:["image"],value:p,render:({open:t})=>(0,e.createElement)(e.Fragment,null,w&&(0,e.createElement)("div",{style:{display:"block"}},(0,e.createElement)(l.ResponsiveWrapper,{naturalWidth:w.media_details.width,naturalHeight:w.media_details.height},(0,e.createElement)("img",{src:w.source_url}))),(0,e.createElement)("div",{style:{display:"block"}},!w&&(0,e.createElement)(l.Button,{variant:"secondary",onClick:t},"Open Media Library"),w&&(0,e.createElement)(l.Button,{onClick:()=>g(null),isLink:!0,isDestructive:!0},"Remove image")))})))))}});const m=({pages:t,onChange:n,value:i})=>(0,e.createElement)(l.SelectControl,{style:{minWidth:"300px"},__nextHasNoMarginBottom:!0,value:i,label:"Select page",onChange:n,options:t.map((function(e){return{value:e.id,label:`${e.meta.mve_timeline_year} - ${e.title.raw}`}}))});(0,o.registerFormatType)("mve-timeline/internal-link",{title:"Internal link",tagName:"a",className:"mve-internal-link",attributes:{name:"data-internal-id"},edit:({isActive:t,onChange:n,value:a,activeAttributes:c,contentRef:s})=>{const[u,d]=(0,e.useState)(s.current),p=(0,i.useSelect)((e=>e("core/editor").getCurrentPostId()),[]),v=(0,i.useSelect)((e=>e("core/block-editor").getSelectedBlock()),[]);if(v&&!["core/paragraph","mve-timeline/intro"].includes(v.name))return null;const g=(0,i.useSelect)((e=>e("core/editor").getEditedPostAttribute("mve_timeline")),[]),_=(0,i.useSelect)((e=>e("core").getEntityRecords("postType","mve_timeline_item",g&&p?{mve_timeline:g,exclude:[p]}:{})),[g,p]);return(0,e.createElement)(r.BlockControls,null,(0,e.createElement)(l.ToolbarButton,{icon:"admin-links",title:"Internal link",onClick:()=>{n((0,o.toggleFormat)(a,{type:"mve-timeline/internal-link"}))},isActive:t}),t&&_&&(0,e.createElement)(l.Popover,{anchor:u,variant:"toolbar"},(0,e.createElement)(l.Card,null,(0,e.createElement)(l.CardBody,null,(0,e.createElement)(m,{pages:_,value:c?.name,onChange:e=>{const t=(0,o.applyFormat)(a,{type:"mve-timeline/internal-link",attributes:{name:e}});n(t)}})))))}})})();